<?xml version="1.0"?>

<launch>

   <arg name="localization"            default="false"/>

   <arg name="cfg"                     default="" /> <!-- To change RTAB-Map's parameters, set the path of config file (*.ini) generated by the standalone app -->
   <arg name="gui_cfg"                 default="~/.ros/rtabmap_gui.ini" />
   <arg name="clear_params"            default="true"/>
   <arg name="output"                  default="screen"/> 
   <arg name="launch_prefix" default=""/>


   <arg name="scan_cloud_topic"        default="/rslidar_points"/>
   <arg name="imu_topic"                default="/imu/data"/> 

   <node pkg="point_cloud_converter" name="point_cloud_converter" type="point_cloud_converter_node" >
      <!-- <remap from="points_in" to="rs_points"/>
      <remap from="points2_out" to="rs_points_edit" /> -->
      
      <remap from="points2_in" to="rslidar_points"/>
      <remap from="points_out" to="rs_points_edit" />
      
   </node>

   <group ns="rtabmap">

   <!-- Visualisation RTAB-Map -->
   <node pkg="rtabmap_viz" type="rtabmap_viz" name="rtabmap_viz" args="-d $(find rtabmap_viz)/launch/config/rgbd_gui.ini" output="screen">
      <param name="subscribe_depth" type="bool" value="false"/>
      <param name="subscribe_rgbd" type="bool" value="true"/>
      <param name="subscribe_scan" type="bool" value="true"/>
      <param name="frame_id" type="string" value="base_link"/>
      <param name="odom_frame_id" type="string" value="odom"/>
      <param name="queue_size" type="int" value="10"/>
      <param name="approx_sync" type="bool" value="true"/>
      <remap from="rgb/image" to="/camera/color/image_raw"/>
      <remap from="depth/image" to="/camera/depth/image_rect_raw"/>
      <remap from="rgb/camera_info" to="/camera/color/camera_info"/>
      <remap from="odom" to="/odometry/filtered"/>
      <remap from="scan" to="/scan"/>
      <remap from="rgbd_image"      to="rgbd_image"/> <!-- output -->
      <remap from="scan_cloud" to="$(arg scan_cloud_topic)"/>
   </node>

</group>

   <!-- Visualization RVIZ -->
   <node pkg="rviz" type="rviz" name="rviz" args="-d $(find my_rtab_map)/rviz/jackal.rviz"/>

   <node pkg="nodelet" type="nodelet" name="points_xyzrgb" args="standalone rtabmap_util/point_cloud_xyzrgb" clear_params="$(arg clear_params)" output="$(arg output)">
      <remap from="rgb/image" to="/camera/color/image_raw"/>
      <remap from="depth/image" to="/camera/depth/image_rect_raw"/>
      <remap from="rgb/camera_info" to="/camera/color/camera_info"/>
      <remap from="rgbd_image" to="rgbd_image"/>
      <param name="decimation" type="double" value="4"/>
      <param name="voxel_size" type="double" value="0.0"/>
      <param name="approx_sync" type="bool" value="false"/>
      <remap from="scan" to="/scan"/>
      <remap from="rgbd_image"      to="rgbd_image"/> <!-- output -->
   </node>

   <include file="$(find jackal_navigation)/launch/include/move_base.launch"/>
</launch>